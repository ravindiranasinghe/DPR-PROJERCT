---
title: "R Notebook"
output: html_notebook
---

```{r}
read.csv("~/Desktop/DPR PROJECT/who_ambient_air_quality_database_version_2024_(v6.1) (4).csv")
```

```{r}
df
```
```{r}
whoAQ_data <- read.csv("~/Desktop/DPR PROJECT/who_ambient_air_quality_database_version_2024_(v6.1) (4).csv") 

  

```



```{r}
library(dplyr)
```

```{r}
selected_columns<-whoAQ_data %>%
  select(country_name, city, year, pm25_concentration, pm10_concentration
,no2_concentration , latitude, longitude)
  selected_columns
```

```{r}
 df <- whoAQ_data %>%
  mutate(
    country_name = as.character(country_name),
    year    = as.integer(year),
    pm25_concentration    = as.numeric(pm25_concentration),
    pm10_concentration    = as.numeric(pm10_concentration),
    no2_concentration     = as.numeric(no2_concentration)
  )
```


```{r}
df <- whoAQ_data %>%
  distinct() %>%            
  filter(pm25_concentration >= 0, pm10_concentration >= 0)   

```

```{r}
whoAQ_data$country_name <- gsub("T√ºrkiye", "Turkiye", whoAQ_data$country_name)

```

```{r}
library(countrycode)
```


```{r}


whoAQ_data <- whoAQ_data %>%
  mutate(continent = countrycode(country_name, "country.name", "continent"))

```


```{r}
any(is.na(whoAQ_data))

```

```{r}
sum(is.na(whoAQ_data))

```

```{r}
colSums(is.na(whoAQ_data))

```

```{r}
prop_missing <- colSums(is.na(whoAQ_data))/nrow(whoAQ_data)

data_clean <- whoAQ_data[, prop_missing <= 0.5]


```



```{r}
 library(dplyr)
library(tidyr)

countries <- c("India","Germany","South Africa",
               "United States of America","Brazil","Australia")

df_sel <- whoAQ_data %>%
  filter(country_name %in% countries)%>% 
  drop_na(pm25_concentration, pm10_concentration,no2_concentration)

```


```{r}
whoAQ_data <- df_sel %>%
  select(-any_of(c("who_region", "iso3", "version", 
                   "pm10_tempcov", "pm25_tempcov", "no2_tempcov",
                   "type_of_stations", "reference", "web_link", 
                   "population", "population_source", "who_ms")))

```







```{r}
head(df_sel)
```





```{r}
cleaned_data <- whoAQ_data

```


```{r}
View(cleaned_data)

```


```{r}
glimpse(cleaned_data)
```

```{r}
head(cleaned_data)
```





```{r}
library("skimr")
```


```{r}

summary(cleaned_data %>% select(where(is.numeric)))
skim(cleaned_data %>% select(where(is.numeric)))  

```


```{r}
cleaned_data %>% summarise(
  n_rows = n(),
  n_countries = n_distinct(country_name),
  n_cities = n_distinct(city),
  n_years = n_distinct(year)
)

```



```{r}
availability <- cleaned_data%>%
  group_by(country_name) %>%
  summarise(
    n_obs = n(),
    n_years = n_distinct(year),
    n_cities = n_distinct(city),
    first_year = min(year, na.rm=TRUE),
    last_year  = max(year, na.rm=TRUE)
  ) %>%
  arrange(desc(n_obs))
(availability)


```

```{r}

country_summary <- cleaned_data %>%
  group_by(country_name, continent) %>%
  summarise(
    n_obs = n(),
    mean_pm25 = mean(pm25_concentration, na.rm=TRUE),
    median_pm25 = median(pm25_concentration, na.rm=TRUE),
    sd_pm25 = sd(pm25_concentration, na.rm=TRUE),
    mean_no2 = mean(no2_concentration, na.rm=TRUE),
    median_no2 = median(no2_concentration, na.rm=TRUE)
  ) %>%
  arrange(desc(mean_pm25))

(country_summary)



```



```{r}
library(ggplot2)
```



```{r}

ggplot(cleaned_data, aes(x = pm25_concentration)) +
  geom_histogram(bins = 40, alpha = 0.6) +
  labs(title = "Global PM2.5 Histogram", x = "PM2.5 (µg/m³)", y = "Count") 
  



```


```{r}

ggplot(cleaned_data, aes(x = reorder(country_name, pm25_concentration, FUN = median), y = pm25_concentration, fill = continent)) +
  geom_boxplot(width = 0.12, outlier.alpha = 0.3) +
  coord_flip() +
  labs(title = "PM2.5 Distribution by Country", x = "Country", y = "PM2.5 (µg/m³)") +
  theme_minimal()

```


```{r}

outliers <- cleaned_data %>%
  group_by(country_name) %>%
  mutate(
    Q1 = quantile(pm25_concentration, 0.25, na.rm=TRUE),
    Q3 = quantile(pm25_concentration, 0.75, na.rm=TRUE),
    IQR = Q3 - Q1,
    lower = Q1 - 1.5 * IQR,
    upper = Q3 + 1.5 * IQR,
    is_outlier = (pm25_concentration < lower | pm25_concentration > upper)
  ) %>%
  filter(is_outlier) %>%
  select(country_name, city, year, pm25_concentration, lower, upper)

outliers %>% count(country_name, sort = TRUE)




```




```{r}
yearly <- cleaned_data %>%
  group_by(country_name, year) %>%
  summarise(mean_pm25_concentration = mean(pm25_concentration, na.rm = TRUE))

ggplot(yearly, aes(x = year, y = mean_pm25_concentration)) +
  geom_line() +
  geom_point(size = 0.8) +
  facet_wrap(~ country_name, scales = "free_y") +
  labs(title = "Yearly PM2.5 Trends (Faceted by Country)") +
  theme_minimal()



```


```{r}

cleaned_data %>% filter(!is.na(no2_concentration)) %>%
  ggplot(aes(x = no2_concentration, y = pm25_concentration, color = country_name)) +
  geom_point(alpha = 0.02) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "PM2.5 vs NO2 (by country)") +
  theme_minimal()
  



```





# visualization part 

```{r}
df_viz <- cleaned_data %>% filter(year >= 2015 & year<= 2020 )

```

```{r}
ggplot(df_viz, aes(x = continent, y = pm25_concentration, fill = continent)) +
  geom_boxplot(outlier.alpha = 0.3) +
  labs(title = "PM2.5 Concentration by Continent (2015-2020)",
       y = "PM2.5 (µg/m³)", x = "continent") +
  theme_minimal()

```


```{r}
ggplot(df_viz, aes(y = reorder(country_name, pm25_concentration, FUN = median),
                   x = pm25_concentration, fill = continent)) +
  geom_boxplot(outlier.alpha = 0.3, width = 0.6) +
  coord_flip() +
  labs(title = "PM2.5 Concentration by Country (2015–2020)",
       x = "Country", y = "PM2.5 (µg/m³)") +
  theme_minimal()

```

```{r}
df_viz %>%
  group_by(year, country_name) %>%
  summarise(mean_pm25 = mean(pm25_concentration, na.rm = TRUE)) %>%
  ggplot(aes(x = year, y = mean_pm25, color = country_name)) +
  geom_line(size = 1) +
  geom_point(size = 1.5) +
  labs(title = "Yearly Mean PM2.5 (2015–2020)",
       y = "Mean PM2.5 (µg/m³)", x = "Year") +
  theme_minimal()

```

```{r}
df_viz %>%
  group_by(year, country_name) %>%
  summarise(mean_pm25_concentration = mean(pm25_concentration, na.rm = TRUE)) %>%
  ggplot(aes(x = year, y = mean_pm25_concentration)) +
  geom_line(color = "steelblue", size = 1) +
  geom_point(color = "darkblue") +
  facet_wrap(~ country_name, scales = "free_y") +
  labs(title = "PM2.5 Trend per Country", y = "Mean PM2.5 (µg/m³)") +
  theme_minimal()

```

